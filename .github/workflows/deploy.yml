  name: CI/CD Pipeline

  on:
    push:
      branches: [ "main" ]

  jobs:
    build-and-deploy:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout Code
          uses: actions/checkout@v3

        - name: Set up Docker
          uses: docker/setup-buildx-action@v2

        - name: Set up Minikube
          uses: manusa/actions-setup-minikube@v2.13.1
          with:
            minikube version: 'latest'
            kubernetes version: 'v1.20.0'

        - name: Build Docker Image
          run: |
            eval $(minikube docker-env)
            docker build -t my-app:latest .

        - name: Deploy to Kubernetes
          run: |
            kubectl apply -f k8s-deployment.yaml
            kubectl rollout status deployment/my-app

        - name: Verify Deployment
          run: |
            kubectl get pods
            kubectl get services
